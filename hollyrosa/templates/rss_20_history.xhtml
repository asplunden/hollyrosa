<?xml version='1.0' encoding='utf-8'?>

<!--
Copyright 2010-2020 Martin Eliasson

This file is part of Hollyrosa

Hollyrosa is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Hollyrosa is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with Hollyrosa.  If not, see <http://www.gnu.org/licenses/>.

-->

<!-- TODO: this RSS thing needs an overhaul or maybe even to be replaced with the new backend system -->

<!-- TODO: refactor away python -->

<?python
import time

def rfc822_time(t):
    return time.strftime('%a, %d %b %Y %H:%M:%S +0100', t)

?>

<rss version="2.0" xmlns:py="http://genshi.edgewall.org/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
  <docs>/history/</docs>
  <description>Hollyrosa history</description>
  <link>/history/</link>
  <atom:link href="/history/rss" rel="self" type="application/rss+xml" />
  <title>Hollyrosa history</title>
  <dc:creator>Martin Eliasson</dc:creator>
  <image>
      <title>Hollyrosa</title>
      <url>http://asplunden.org/reachesofcivilization/static/images/reaches_rss_logo.jpg</url>
      <link>http://asplunden.org/reachesofcivilization/</link>
      <description>Hollyrosa by Martin Eliasson</description>
  </image>

  <ttl>60</ttl>

  <pubDate>${rfc822_time(publishing_date)}</pubDate>
  <item py:for="h in history">
      <title>${change_op_map[h.change_op]}</title>
      <link>${tg.url('/booking/view_booked_booking', id=h.booking_id)}</link>
      <description>${h.change}</description>
      <guid>${tg.url('/history/item', id=h.id)}</guid>
      <dc:creator>Martin Eliasson</dc:creator>
      <pubDate>${h.timestamp}</pubDate>
  </item>
  </channel>
</rss>
