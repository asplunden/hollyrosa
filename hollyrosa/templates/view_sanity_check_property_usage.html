<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--
Copyright 2010, 2011, 2012 Martin Eliasson

This file is part of Hollyrosa

Hollyrosa is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Hollyrosa is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with Hollyrosa.  If not, see <http://www.gnu.org/licenses/>.

-->

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">

  <xi:include href="master.html" />

<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
  <title>Sanity Check</title>
  
  <script src="${tg.url('/scripts/dojo-release-1.8.0/dojo/dojo.js')}" data-dojo-config="async: true" djConfig="parseOnLoad: true, debugAtAllCosts: true"></script>
  <script>
  
  
  require(["dojo/ready", "dojo/dom", "dojo/dom-construct", "dojo/request/xhr"], function(ready, dom, domConstruct, xhr) {
  
  
function on_booking_deleted(response_data) {
    var booking = response_data['delete_req_booking_id'];
    var to_remove = dom.byId('booking_id_' + booking);
    domConstruct.destroy(to_remove);
}


function on_booking_warning_ignored(response_data) {
    var booking_id = response_data['booking_id'];
    var to_remove = dom.byId('booking_id_' + booking_id);
    domConstruct.destroy(to_remove);
}



function unschedule_booking(booking_id, activity_id, visiting_group_id)
{
    dom.byId('delete_req_booking_id').value =  booking_id;
    dom.byId('delete_req_visiting_group_id').value =  visiting_group_id;
    dom.byId('delete_req_activity_id').value =  activity_id;
    xhr("${tg.url('/hollyrosa/booking/unschedule_booking_async')}",
    { 
    handleAs:"json",
    form:"delete_booking_form",
    method: "POST"}).then(on_booking_deleted);
}


function ignore_warning(booking_id)
{
    xhr("${tg.url('/booking/ignore_booking_warning_async')}",
    {
    handleAs:"json",
    query: {'booking_id':booking_id},
    method:"POST"}).then(on_booking_warning_ignored);
}


ready(function() {
// add event handlers here for the java scripts
// in the long run, add module for notes. Drawing. Adding. Deleteing. Viewing.
// booking day needs menus for uncheduled bookings
// need to find out how to disable menu items dynamically on show.
});

});
  </script>
</head>

<body>
    <h2>Sanity Check</h2>
    <h2>Problems</h2>
    <form name="delete_booking_form" id="delete_booking_form" method="get" >
        <input type="hidden" name="delete_req_booking_id" id="delete_req_booking_id" />
        <input type="hidden" name="visiting_group_id" id="delete_req_visiting_group_id" value=""/>
        <input type="hidden" name="activity_id"  id="delete_req_activity_id" value=""/>
    </form>
    
    <table>
        <tr py:for="p in problems" id="booking_id_${p.booking.id}" class="problem_severity_${p.severity}">
            <td><a href="${tg.url('/visiting_group/show_visiting_group', {'id':p.booking.visiting_group_id})}">${visiting_group_map[p.booking.visiting_group_id]['name']}</a></td>
            <td>${p.msg}</td>
            <td>
            <ul class="any_menu">
                <li><a href="${tg.url('/booking/view_booked_booking', {'id':p.booking.id})}">view</a></li>
                <li><a href="javascript:unschedule_booking(${p.booking.id}, ${p.booking.activity_id}, ${p.booking.visiting_group_id});">unschedule</a></li>
                <li><a href="javascript:ignore_warning('${p.booking.id}');">ignore warning</a></li>
            </ul>
            </td>
        </tr>
    </table>
</body>
</html>
